<html>

<body>
<script type="text/javascript" src="js/socket.io.min.js"></script>
    <script>
        var socket = io();
        var controlling = false;
        var waitingTime = 0;
        const checkupTime = 1000;

        var x = 0,
            y = 0;

        var setXY = function() {
              socket.emit('xy', {
                  'xy': [x, y]
              });
          }

    </script>
    <div id="controlInfo">No connection to Host</div>

    <input id="xSlider" type="range" min="-255" max="255" step="1" oninput="x = this.value; setXY();"/>
    <input id="ySlider" type="range" min="-255" max="255" step="1" oninput="y = this.value; setXY();"/>

    <script>



        var toggleControlElements = function(control) {
            //controlElements.disabled = !control;
        }

        //toggle sliders initially
        toggleControlElements(controlling);

        //set intial slider values
        /*
        socket.on('initialize', function(msg) {
            //set joystick
        });
        */

        //lock sliders if user is not in control
        socket.on('controlling', function(msg) {
            controlling = msg.control;
            //toggleControlElements(controlling);

            //set control info
            if (controlling) {
                controlInfo.textContent = "Du kontrollierst den ArTank! Mal was cooles!";
            } else {
                //check if waiting time is still correct, if not, change it
                if (waitingTime !== msg.waitingTime && msg.waitingTime != "NaN") {
                    waitingTime = Math.floor(msg.waitingTime / 1000);
                }
            }
        });

        //transmit slider values if user is not controlling
        /*
        socket.on('color', function(msg) {
            $('#colorpickerHolder').ColorPickerSetColor(msg);

            rgb = msg.rgb;
        });
*/
        //if client is not controlling, periodically check if control has been given to client
        var controllerCheck = function() {
            if (!controlling) {
                console.log("Checking for Controller change...");
                socket.emit('controllercheck', {});
            }
            setTimeout(
                controllerCheck, checkupTime);
        }

        controllerCheck();

        //set waiting timer
        var waitingTimer = function() {
            if (!controlling) {
                controlInfo.textContent = waitingTime + " Sekunden, bis du Panzermaler wirst!";

                if (waitingTime > 0)
                    --waitingTime;
            }
            setTimeout(waitingTimer, 1000);
        }

        waitingTimer();
    </script>
</body>

</html>
